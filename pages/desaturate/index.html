<!doctype html><html lang=en><head><meta charset=utf-8><title>SV Control: Desaturating Reaction Wheels in the Satellite Simulator | perilune.space </title><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=onion-location content="http://dakota3sjlgd5qt5nygektopktodk4krxw56xhkyzljhxuj3kroz5qqd.onion"><link rel=icon type=image/png href=/images/favicon.png><link href=/css/index.css rel=stylesheet><link rel=stylesheet href=/css/katex-0.12.0.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous><script defer src=/files/katex-0.12.0.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous></script><script defer src=/files/auto-render-0.12.0.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous onload=renderMathInElement(document.body)></script></head><body id=top><header><a href=/><span id=title>perilune.space</span></a><br><span id=subtitle>“Every one of us is, in the cosmic perspective, precious. If a human disagrees with you, let him live. In a hundred billion galaxies, you will not find another.”<br>― Carl Sagan, Cosmos</span></header><nav class=topnav><div id=navbar><label for=nav-toggle id=nav-button><img alt="Toggle navigation" src=/images/nav-toggle.svg></label>
<input id=nav-toggle type=checkbox>
<a class=logo href=/>Home</a>
<a href=/pages>Pages</a>
<a href=/about>About Me</a>
<a href=/resume.pdf>Resume</a>
<a href=https://www.qrz.com/db/kq6g/>Amateur Radio</a>
<a href=/contact>Contact</a></div></nav><main><div class=content><section><h1>SV Control: Desaturating Reaction Wheels in the Satellite Simulator</h1><p>Background: my professor for Space Vehicle control (Dr. Eric Swenson) wrote an incredible satellite dynamics simulator with a PID controller in MATLAB. Assignments for the class provided a specific end condition of the vehicle, and we wrote code that controls the simulator. A big part of it was representing the rotation from initial to final attitude; I liked to use dot/cross products, Euler axis/angle, DCMs, and quaternions depending on the situation. Below is my favorite problem out of all the assignments</p><h2 id=objective>Objective</h2><p>As shown below, the objective for this problem is to point the SV body axes at \(\langle 1,1,1 \rangle\frac{1}{\sqrt 3} \) in the inertial frame, and use the thrusters to dump angular momentum accumulated from a disturbance torque once the reaction wheels saturate at 3500 rpm.</p><figure><img src=/pages/desaturate/rwspeed.png alt="plot of reaction wheel speed vs time"><figcaption><p>Reaction wheel RPM drops from 3500 to 1000 during desaturation, while thrusters hold the vehicle at a constant attitude</p></figcaption></figure><p>NOTE: \(\tau_3\) is significantly smaller than the other torques because the 3-axis has a much lower mass moment of inertia.</p><figure><img src=/pages/desaturate/angmomentum.png alt="plot of SV angular momentum vs time"><figcaption><p>Angular momentum is constantly increasing from the disturbance torque; desaturation reduces it to the amount stored by the reaction wheels at 1000 RPM</p></figcaption></figure><figure><img src=/pages/desaturate/initial-attitude.png alt="initial attitude of satellite with parameters"><figcaption><p>Initial attitude of space vehicle \(\langle 1,1,1 \rangle_i \)</p></figcaption></figure><figure><img src=/pages/desaturate/final-attitude.png alt="final attitude of satellite with parameters"><figcaption><p>Final attitude of space vehicle \(\frac{1}{\sqrt 3}\langle 1,1,1 \rangle_i \)</p></figcaption></figure><h2 id=interesting-code-snippets>Interesting Code Snippets</h2><h3 id=commanded-attitude>Commanded attitude</h3><p>Computes the final attitude by crossing the body axes into the target vector, converting to euler angle/axis, then a direction cosine matrix multiplied by an extra 3-rotation, then a quaternion, which ultimately becomes the transmuted quaternion matrix for simulator input.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-matlab data-lang=matlab><span style=display:flex><span><span style=color:#75715e>%% FINAL COMMANDED ATTITUDE via a rotation matrix and quaternions</span>
</span></span><span style=display:flex><span>target = [ <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>1</span> ]<span style=color:#f92672>/</span>sqrt(<span style=color:#ae81ff>3</span>);
</span></span><span style=display:flex><span>b3_i= [<span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>% Quaternion pointed at target</span>
</span></span><span style=display:flex><span>a1 = cross(b3_i, target)<span style=color:#f92672>&#39;</span>;
</span></span><span style=display:flex><span>a1=a1<span style=color:#f92672>/</span>norm(a1);
</span></span><span style=display:flex><span>phi = acos(dot(b3_i, target)<span style=color:#f92672>/</span>(norm(b3_i)<span style=color:#f92672>*</span>norm(target)));
</span></span><span style=display:flex><span>[<span style=color:#f92672>~</span>,<span style=color:#f92672>~</span>, R_target, <span style=color:#f92672>~</span>] = Q2R([a1<span style=color:#f92672>*</span>sin(phi<span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>); cos(phi<span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>)]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>% Additional 3-rotation</span>
</span></span><span style=display:flex><span>theta_1 = deg2rad(<span style=color:#ae81ff>220</span>);
</span></span><span style=display:flex><span>R_3_1 = [ cos(theta_1)   sin(theta_1)     <span style=color:#ae81ff>0</span>  ; 
</span></span><span style=display:flex><span>         <span style=color:#f92672>-</span>sin(theta_1)   cos(theta_1)     <span style=color:#ae81ff>0</span>   ;
</span></span><span style=display:flex><span>              <span style=color:#ae81ff>0</span>               <span style=color:#ae81ff>0</span>           <span style=color:#ae81ff>1</span>];
</span></span><span style=display:flex><span>R_bi = R_3_1<span style=color:#f92672>*</span>R_target;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>% Final commanded attitude</span>
</span></span><span style=display:flex><span>[<span style=color:#f92672>~</span>,<span style=color:#f92672>~</span>,q_commanded] = R2Q(R_bi);
</span></span><span style=display:flex><span>disp(sprintf(<span style=color:#e6db74>&#39;Commanded quaternion = [ %8.6f   %8.6f   %8.6f   %8.6f ]&#39;</span>,q_commanded))</span></span></code></pre></div><h3 id=desaturate>Desaturate</h3><p>The desaturation code runs once per cycle of the outer control loop. It checks whether the wheels are saturated or finished desaturating, then sets a global boolean to turn the next function on/off. If on, it uses the equation \(\dot\psi=\frac \tau D\) to determine the wheel deceleration rate that produces an internal torque equal and opposite the external torque produced by the thrusters; where \(\dot\psi\) is angular accerlation, \(D\) is the wheel&rsquo;s mass moment of inertia, and \(\tau\) is the external torque. The angular acceleration (\(\dot\psi\)) is in the direction opposite the wheel&rsquo;s current rotation. This process repeats for each control timestep until wheel RPM drops below 1000.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-matlab data-lang=matlab><span style=display:flex><span><span style=color:#66d9ef>for</span> ctr = <span style=color:#ae81ff>1</span> : <span style=color:#ae81ff>3</span> <span style=color:#75715e>% Enforce RW torque and angular velocity constraints</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> abs(psi(ctr)) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>3500</span><span style=color:#f92672>*</span><span style=color:#ae81ff>2</span><span style=color:#f92672>*</span>pi<span style=color:#f92672>/</span><span style=color:#ae81ff>60</span> <span style=color:#f92672>&amp;&amp;</span> desaturate(ctr) <span style=color:#f92672>==</span> false
</span></span><span style=display:flex><span>    desaturate(ctr) = true;
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> abs(psi(ctr)) <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>1000</span><span style=color:#f92672>*</span><span style=color:#ae81ff>2</span><span style=color:#f92672>*</span>pi<span style=color:#f92672>/</span><span style=color:#ae81ff>60</span> <span style=color:#f92672>&amp;&amp;</span> desaturate(ctr) <span style=color:#f92672>==</span> true
</span></span><span style=display:flex><span>    desaturate(ctr) = false;
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> desaturate(ctr) <span style=color:#f92672>==</span> true
</span></span><span style=display:flex><span>        <span style=color:#75715e>%disp(strcat(&#39;RW #&#39;,num2str(ctr), &#39;, above 3500 rpm at time=&#39;,num2str(start_time)) );</span>
</span></span><span style=display:flex><span>        thruster_torque(ctr) = <span style=color:#f92672>-</span><span style=color:#ae81ff>2</span><span style=color:#f92672>*</span>nominal_thrust<span style=color:#f92672>*</span>moment_arm(ctr);
</span></span><span style=display:flex><span>        thrusters_fired_ctr = thrusters_fired_ctr <span style=color:#f92672>+</span> <span style=color:#ae81ff>2</span><span style=color:#f92672>*</span>sum(abs(thruster_torque)); <span style=color:#75715e>% count # times the thrusters are fired</span>
</span></span><span style=display:flex><span>        psi_dot(ctr) = sign(psi(ctr))<span style=color:#f92672>*</span>thruster_torque(ctr)<span style=color:#f92672>/</span>D_rotor;
</span></span><span style=display:flex><span>    M_b_ext = M_b_ext <span style=color:#f92672>+</span> thruster_torque; <span style=color:#75715e>% add tot total external torque on SV</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span></span></span></code></pre></div><p>Last modified: 2023-11-20</p></section></div></main><footer><span>&copy;2018-2025 Dakota Richline </span><a rel=license href=http://creativecommons.org/licenses/by/4.0/><img alt="Creative Commons License" style=border-width:0 src=/images/80x15.png></a><br><span><i>Ad Astra Per Scientiam!</i></span></footer></body></html>