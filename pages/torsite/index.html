<!doctype html><html lang=en><head><meta charset=utf-8><title>How I Hosted this Website on Tor | perilune.space</title><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=onion-location content="http://dakota3sjlgd5qt5nygektopktodk4krxw56xhkyzljhxuj3kroz5qqd.onion"><link rel=icon type=image/png href=/images/favicon.png><link href=/css/index.css rel=stylesheet><link rel=stylesheet href=/css/katex-0.12.0.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous><script defer src=/files/katex-0.12.0.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous></script><script defer src=/files/auto-render-0.12.0.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous onload=renderMathInElement(document.body)></script></head><body id=top><header><a href=/><span id=title>perilune.space</span></a><br><span id=subtitle>“Every one of us is, in the cosmic perspective, precious. If a human disagrees with you, let him live. In a hundred billion galaxies, you will not find another.”<br>― Carl Sagan, Cosmos</span></header><nav class=topnav><div id=navbar><label for=nav-toggle id=nav-button><img alt="Toggle navigation" src=/images/nav-toggle.svg></label>
<input id=nav-toggle type=checkbox>
<a class=logo href=/>Home</a>
<a href=/pages>Pages</a>
<a href=/about>About Me</a>
<a href=/resume.pdf>Resume</a>
<a href=https://www.qrz.com/db/kq6g/>Amateur Radio</a>
<a href=/contact>Contact</a></div></nav><main><div class=content><section><h1>How I Hosted this Website on Tor</h1><nav id=TableOfContents><ul><li><a href=#generating-a-vanity-domain>Generating a Vanity Domain</a></li><li><a href=#tor-proxy>Tor Proxy</a></li><li><a href=#web-server>Web Server</a></li><li><a href=#finishing-touches>Finishing Touches</a></li></ul></nav><p>I have a soft spot for cryptography and alternative web protocols like <a href=https://gemini.circumlunar.space/>Gemini</a> and Tor. Experimenting with any of these protocols is just a hobby project, but I&rsquo;ve found that hosting on Tor is more practical and by far the best option for learning. This is how I hosted a <a href=http://dakota3sjlgd5qt5nygektopktodk4krxw56xhkyzljhxuj3kroz5qqd.onion>mirror</a> of richline.rocks on Tor:</p><h2 id=generating-a-vanity-domain>Generating a Vanity Domain</h2><p>The latest version of Tor addressing uses an ed25519 key as the URL; brute force is the only method to generate a domain name containing a particular series of characters. I used <a href=https://github.com/rdkr/oniongen-go><code>oniongen-go</code></a> to generate the keypair because Go allowed me to compile a multithreaded static-linked binary, drop it on FIT&rsquo;s student server, and run the Xeons full-blast for a few days with a high process niceness. As a result of all that wasted energy, I have a few fancy domain names starting with &ldquo;dakota.&rdquo;</p><h2 id=tor-proxy>Tor Proxy</h2><p>All the services on my machines are containerized in <code>podman</code> using existing OCI containers from Docker Hub. For this project, I used the image <a href=https://hub.docker.com/r/goldy/tor-hidden-service/>goldy/tor-hidden-service</a> to run my Tor proxy. There was no configuration required beyond the example compose file, but I&rsquo;ve copied my <code>compose.yml</code> below for reference:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#34;2&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>tor</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>goldy/tor-hidden-service</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>tor</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>links</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>caddy</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>SERVICE1_TOR_SERVICE_HOSTS</span>: <span style=color:#ae81ff>80</span>:<span style=color:#ae81ff>caddy:80</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>SERVICE1_TOR_SERVICE_VERSION</span>: <span style=color:#e6db74>&#39;3&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Optional as tor version 2 is not supported anymore</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>SERVICE1_TOR_SERVICE_KEY</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          (privkey)</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># tor v3 address private key base 64 encoded</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>TOR_EXTRA_OPTIONS</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          HiddenServiceNonAnonymousMode 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          HiddenServiceSingleHopMode 1</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Uses a single hop between server and rendezvous point instead of 3; boosts performance to that of a clearnet site</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>caddy</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>caddy:latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>hostname</span>: <span style=color:#ae81ff>caddy</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>$PWD/Caddyfile:/etc/caddy/Caddyfile</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/home/dakota/drichline.github.io:/var/www/html</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>data:/data</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>config:/config</span>
</span></span><span style=display:flex><span><span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>config:</span></span></span></code></pre></div><h2 id=web-server>Web Server</h2><p>Caddy is my preferred web server. I tend not to use its automatic SSL feature because most of my services are internal, but it&rsquo;s amazing how much it can do with simple configuration; one-liner reverse proxies with websockets are amazing. My clearnet site is hosted on GitHub Pages, so the rendered site files are stored in the <code>gh-pages</code> branch of the main repository. To get an updated copy of the site onto my server&rsquo;s local storage, I just wrote a systemd unit that fetches changes every 10 minutes:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[Unit]
</span></span><span style=display:flex><span>Description=Update drichline.github.io directory
</span></span><span style=display:flex><span>[Timer]
</span></span><span style=display:flex><span>OnCalendar=*-*-* *:0/10:00
</span></span><span style=display:flex><span>[Install]
</span></span><span style=display:flex><span>WantedBy=timers.target</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[Unit]
</span></span><span style=display:flex><span>Description=Update drichline.github.io directory
</span></span><span style=display:flex><span>[Service]
</span></span><span style=display:flex><span>type=oneshot
</span></span><span style=display:flex><span>User=dakota
</span></span><span style=display:flex><span>ExecStart=/usr/bin/git -C /home/dakota/drichline.github.io/ pull origin gh-pages
</span></span><span style=display:flex><span>ExecStartPost=/usr/bin/git -C /home/dakota/drichline.github.io/ clean -fxd</span></span></code></pre></div><p>It&rsquo;s a slightly messy solution, but still the best option for this particular machine. With this directory of site files, I can write a simple <code>Caddyfile</code> that hosts the website on port 80 of its podman container:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>:80 {
</span></span><span style=display:flex><span>    root * /var/www/html
</span></span><span style=display:flex><span>    file_server</span></span></code></pre></div><h2 id=finishing-touches>Finishing Touches</h2><p>At this point, Tor should be connecting to other nodes with no network configuration necessary, Caddy is serving the site on port 80, and the Tor container should be able to <code>curl</code> files from it. To get the fancy &ldquo;.onion available&rdquo; button in the Tor browser URL bar, the <code>onion-location</code> property needs to be set in the http headers or html head. Since my site is hosted on GitHub, I simply added the following line to my page template:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>http-equiv</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;onion-location&#34;</span> <span style=color:#a6e22e>content</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://dakota3sjlgd5qt5nygektopktodk4krxw56xhkyzljhxuj3kroz5qqd.onion&#34;</span> /&gt;</span></span></code></pre></div><p>And the result:</p><figure><img src=/pages/torsite/urlbar.png alt="Tor Browser URL bar showing .onion available"></figure><p>Last modified: 2022-08-08</p></section></div></main><footer><span>&copy;2018-2025 Dakota Richline </span><a rel=license href=http://creativecommons.org/licenses/by/4.0/><img alt="Creative Commons License" style=border-width:0 src=/images/80x15.png></a><br><span><i>Ad Astra Per Scientiam!</i></span></footer></body></html>